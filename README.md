Dino Ventures - Internal Wallet Service ü¶ñ
Author: Pushpak Jain

üìñ Overview
This project is a high-availability, closed-loop wallet service designed to handle virtual currencies (e.g., Gold Coins, Reward Points). The system ensures strict data integrity, guarantees no lost transactions under high concurrency, and provides a fully auditable double-entry ledger.

üöÄ Quick Start (Docker)
The application is fully containerized. The database will automatically seed itself with a System Treasury account and two player wallets upon startup.

Prerequisites: Docker and Docker Compose installed.

Clone or unzip the repository.

Open your terminal in the project root.

Run the following command:

Bash
docker-compose up --build
The API will be available at http://localhost:8080.

üåü Bonus: Interactive UI Dashboard
To make testing effortless, I have included a lightweight Frontend UI.
Once the Docker container is running, simply open your browser and navigate to:
üëâ http://localhost:8080/ (Here you can simulate transactions, view real-time balances, and test the Idempotency constraints visually).

üõ†Ô∏è Tech Stack & Justification
Language: Java 21 (LTS) - Chosen for its robust concurrency utilities, strong typing, and enterprise-grade stability.

Framework: Spring Boot 3.2 - Enables rapid REST API development and clean dependency injection.

Database: PostgreSQL 16 - Selected specifically for its strict ACID compliance and advanced row-level locking mechanisms, which are mandatory for financial ledgers.

Infrastructure: Docker & Docker Compose - Ensures environmental consistency (the "it works on my machine" problem) and provides a one-click setup.

üß† System Architecture & Concurrency Strategy
Meeting the "Critical Constraints" required moving beyond standard CRUD operations and implementing deep database fundamentals.

1. The Double-Entry Ledger
Instead of simply updating a balance column, this system models real-world accounting. Every transaction inserts an immutable record into the transactions table with a source_wallet and destination_wallet. Money is never created or destroyed, only moved.

2. Concurrency & Race Conditions (Pessimistic Locking)
To prevent the "Lost Update" anomaly during high-traffic scenarios, the system utilizes Pessimistic Write Locking (SELECT ... FOR UPDATE).
When a transaction is initiated, the database physically locks the specific rows in the wallets table. Any concurrent requests attempting to modify those same wallets will queue up at the database level until the current transaction completes (Commit or Rollback), guaranteeing mathematical accuracy.

3. Deadlock Avoidance
Locking multiple rows simultaneously introduces the risk of a circular wait (Deadlock). To mitigate this, the LedgerService enforces a strict Lexicographical Lock Ordering.
Before locking, the system compares the source_wallet_id and destination_wallet_id (UUIDs) and always requests the lock for the smaller UUID first. This mathematical consistency completely eliminates the possibility of a circular dependency.

4. Idempotency (Double-Charge Protection)
To protect against network retries or a user double-clicking the "Pay" button, the API requires an X-Idempotency-Key in the HTTP Header.

The key represents the intent to pay, generated by the client.

The backend verifies this key against the transactions table.

If a duplicate key is detected, the system safely bypasses the financial logic and returns the cached successful response, ensuring the user is only charged once.

üì° API Documentation
1. Execute Transaction (Top-up, Spend, Bonus)
POST /api/v1/wallets/transactions

Headers:

Content-Type: application/json

X-Idempotency-Key: <unique-uuid-or-string>

Body:

JSON
{
    "sourceWalletId": "44444444-4444-4444-4444-444444444444",
    "destinationWalletId": "55555555-5555-5555-5555-555555555555",
    "amount": 50.00,
    "type": "SPEND"
}
2. Check Balance
GET /api/v1/wallets/{walletId}/balance

Response:

JSON
{
    "walletId": "44444444-4444-4444-4444-444444444444",
    "currency": "GOLD_COINS",
    "balance": 450.00
}